{% extends 'base.html' %}
{% load static %}

{% block title %}Coupons - Karupatti Shop{% endblock %}

{% block content %}
<div class="container my-5">
    <h2 class="mb-4">Available Coupons</h2>
    
    {% if coupons %}
    <div class="row">
        {% for coupon in coupons %}
        <div class="col-md-6 mb-4">
            <div class="card border-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h5 class="card-title mb-1">
                                <span class="badge bg-success">{{ coupon.code }}</span>
                            </h5>
                            <p class="card-text">{{ coupon.description }}</p>
                        </div>
                        <div class="text-end">
                            {% if coupon.discount_type == 'percentage' %}
                            <h3 class="text-success mb-0">{{ coupon.discount_value }}%</h3>
                            <small class="text-muted">OFF</small>
                            {% else %}
                            <h3 class="text-success mb-0">${{ coupon.discount_value }}</h3>
                            <small class="text-muted">OFF</small>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="small text-muted">
                        {% if coupon.min_purchase_amount > 0 %}
                        <p class="mb-1">
                            <i class="bi bi-cart"></i> Min. purchase: ${{ coupon.min_purchase_amount }}
                        </p>
                        {% endif %}
                        
                        {% if coupon.max_discount_amount %}
                        <p class="mb-1">
                            <i class="bi bi-tag"></i> Max. discount: ${{ coupon.max_discount_amount }}
                        </p>
                        {% endif %}
                        
                        <p class="mb-1">
                            <i class="bi bi-clock"></i> Valid until: {{ coupon.valid_until|date:"M d, Y" }}
                        </p>
                        
                        {% if coupon.usage_limit %}
                        <p class="mb-0">
                            <i class="bi bi-people"></i> {{ coupon.usage_limit|add:"-"|add:coupon.times_used }} uses remaining
                        </p>
                        {% endif %}
                    </div>
                    
                    <button class="btn btn-outline-success btn-sm mt-3 copy-coupon" data-code="{{ coupon.code }}">
                        <i class="bi bi-clipboard"></i> Copy Code
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="bi bi-ticket-perforated" style="font-size: 4rem; color: #ddd;"></i>
        <h4 class="mt-3">No coupons available</h4>
        <p class="text-muted">Check back later for discount codes!</p>
    </div>
    {% endif %}
</div>

<script>
document.querySelectorAll('.copy-coupon').forEach(button => {
    button.addEventListener('click', function() {
        const code = this.dataset.code;
        navigator.clipboard.writeText(code).then(() => {
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="bi bi-check"></i> Copied!';
            setTimeout(() => {
                this.innerHTML = originalText;
            }, 2000);
        });
    });
});
</script>
{% endblock %}
